{"ast":null,"code":"var _jsxFileName = \"/home/luong/kobuki_web/src/components/Map/Map.js\";\nimport React, { Component } from \"react\";\nimport { Container, Card, Button, Form, Row, Col, Alert } from \"react-bootstrap\";\nimport ROSLIB from \"roslib\";\nimport Nav2d from \"react-nav2djs\";\nimport \"./Map.css\";\nimport \"../CommonStyle.css\";\n\nclass Map extends Component {\n  constructor(props) {\n    super(props);\n    this.ros = props.ros || null;\n    this.state = {\n      command: 'none',\n      message: 'Robot is ready !',\n      stationName: 'NoName',\n      stations: []\n    };\n    this.onAddStation = this.onAddStation.bind(this);\n    this.onClickStation = this.onClickStation.bind(this);\n    this.onSetGoal = this.onSetGoal.bind(this);\n    this.actionClient = null;\n    this.InsertStationService = null;\n    this.DeleteStationService = null;\n    this.GetStationService = null;\n  }\n\n  componentDidMount() {\n    if (this.props.ros != null) {\n      this.ros = this.props.ros;\n      var serverName = this.props.serverName || '/move_base';\n      var actionName = this.props.actionName || 'move_base_msgs/MoveBaseAction';\n      this.actionClient = new ROSLIB.ActionClient({\n        ros: this.ros,\n        actionName: actionName,\n        serverName: serverName\n      });\n      this.InsertStationService = new ROSLIB.Service({\n        ros: this.ros,\n        name: '/add_station',\n        serviceType: 'kobuki_ui/AddStation'\n      });\n      this.DeleteStationService = new ROSLIB.Service({\n        ros: this.ros,\n        name: '/delete_station',\n        serviceType: 'kobuki_ui/DeleteStation'\n      });\n      this.GetStationService = new ROSLIB.Service({\n        ros: this.ros,\n        name: '/get_station_list',\n        serviceType: 'kobuki_ui/GetStationList'\n      });\n      this.GetStationService.callService(null, res => {\n        this.setState({\n          stations: res.station_list\n        });\n      });\n    }\n  }\n\n  onAddStation(newStation) {\n    if (newStation) {\n      var stationList = this.state.stations;\n      stationList.push(newStation);\n      this.setState({\n        stations: stationList\n      });\n      console.log(\"added new station\", newStation.name);\n      var request = new ROSLIB.ServiceRequest({\n        name: newStation.name,\n        positionX: newStation.positionX,\n        positionY: newStation.positionY,\n        positionZ: newStation.positionZ,\n        orientationX: newStation.orientationX,\n        orientationY: newStation.orientationY,\n        orientationZ: newStation.orientationZ,\n        orientationW: newStation.orientationW,\n        id: newStation.id\n      });\n      this.InsertStationService.callService(request);\n    }\n  }\n\n  onClickStation(stationId) {\n    var targetIndex = -1;\n    this.state.stations.forEach((item, index) => {\n      if (item.id === stationId) {\n        targetIndex = index;\n      }\n    });\n\n    if (targetIndex >= 0) {\n      if (this.state.command === 'DeleteStation') {\n        console.log(\"remove station\", this.state.stations[targetIndex].name);\n        var request = new ROSLIB.ServiceRequest({\n          id: this.state.stations[targetIndex].id\n        });\n        this.DeleteStationService.callService(request);\n        var stationList = this.state.stations;\n        stationList.splice(targetIndex, 1);\n        this.setState({\n          stations: stationList\n        });\n      } else {\n        console.log(\"Go to station\", this.state.stations[targetIndex].name);\n        this.setState({\n          message: 'Robot is moving to station ' + this.state.stations[targetIndex].name,\n          command: 'CancelGoal'\n        });\n        var positionVec3 = new ROSLIB.Vector3(null);\n        var orientation = new ROSLIB.Quaternion({\n          x: this.state.stations[targetIndex].orientationX,\n          y: this.state.stations[targetIndex].orientationY,\n          z: this.state.stations[targetIndex].orientationZ,\n          w: this.state.stations[targetIndex].orientationW\n        });\n        positionVec3.x = this.state.stations[targetIndex].positionX;\n        positionVec3.y = this.state.stations[targetIndex].positionY;\n        var pose = new ROSLIB.Pose({\n          position: positionVec3,\n          orientation: orientation\n        });\n        console.log(pose);\n        var goal = new ROSLIB.Goal({\n          actionClient: this.actionClient,\n          goalMessage: {\n            target_pose: {\n              header: {\n                frame_id: 'map'\n              },\n              pose: pose\n            }\n          }\n        });\n        goal.send();\n      }\n    }\n  }\n\n  onSetGoal(rootObject, pose) {\n    console.log(\"added new goal\");\n    this.setState({\n      message: 'Robot is moving to Goal'\n    });\n    var goal = new ROSLIB.Goal({\n      actionClient: this.actionClient,\n      goalMessage: {\n        target_pose: {\n          header: {\n            frame_id: 'map'\n          },\n          pose: pose\n        }\n      }\n    });\n    goal.send();\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      className: \"box-margin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Card, {\n      border: \"secondary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Card.Header, {\n      style: {\n        fontSize: \"1.2rem\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 54\n      }\n    }, \"Map\")), /*#__PURE__*/React.createElement(Card.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      className: \"map-container\",\n      id: \"map\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Container, {\n      className: \"map-controller\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      className: \"map-button color\",\n      onClick: () => this.setState({\n        command: 'SetGoal',\n        message: 'Send goal to your robot'\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 17\n      }\n    }, \"Set Goal\"), /*#__PURE__*/React.createElement(Button, {\n      className: \"map-button\",\n      variant: \"success\",\n      onClick: () => this.setState({\n        command: 'AddStation',\n        message: 'Add new station',\n        stationName: 'NoName'\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 17\n      }\n    }, \"Add Station\"), /*#__PURE__*/React.createElement(Button, {\n      className: \"map-button\",\n      variant: \"outline-success\",\n      onClick: () => this.setState({\n        command: 'DeleteStation',\n        message: 'Click to delete station'\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 17\n      }\n    }, \"Delete Station\"), /*#__PURE__*/React.createElement(Button, {\n      className: \"map-button\",\n      variant: \"warning\",\n      onClick: () => this.setState({\n        command: 'none',\n        message: 'Robot is ready !'\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 17\n      }\n    }, \"Cancel\")), /*#__PURE__*/React.createElement(Container, {\n      style: {\n        width: \"28rem\",\n        height: \"4rem\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 15\n      }\n    }, this.state.command === 'AddStation' && /*#__PURE__*/React.createElement(Form, {\n      onChange: event => this.setState({\n        stationName: event.target.value\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Form.Group, {\n      as: Row,\n      controlId: \"formHorizontalEmail\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Form.Label, {\n      column: true,\n      sm: 3,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 23\n      }\n    }, \"Station:\"), /*#__PURE__*/React.createElement(Col, {\n      sm: 8,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 23\n      }\n    }, /*#__PURE__*/React.createElement(Form.Control, {\n      type: \"text\",\n      placeholder: \"ex: Table\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 25\n      }\n    })))), this.state.command !== 'AddStation' && /*#__PURE__*/React.createElement(Alert, {\n      variant: \"info\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 175,\n        columnNumber: 19\n      }\n    }, this.state.message)), /*#__PURE__*/React.createElement(Nav2d, {\n      id: \"random\",\n      imageRobot: require('./jarvis.png'),\n      imageGoalArrow: require('./arrow-red.png'),\n      imageStationArrow: require('./arrow-green.png'),\n      ros: this.ros,\n      serverName: \"/move_base\",\n      command: this.state.command,\n      onSetGoal: (obj, pose) => this.onSetGoal(obj, pose),\n      onAddStation: newStation => this.onAddStation(newStation),\n      onClickStation: station => this.onClickStation(station),\n      stationName: this.state.stationName,\n      station: this.state.stations,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 15\n      }\n    })))));\n  }\n\n}\n\nexport default Map;","map":{"version":3,"sources":["/home/luong/kobuki_web/src/components/Map/Map.js"],"names":["React","Component","Container","Card","Button","Form","Row","Col","Alert","ROSLIB","Nav2d","Map","constructor","props","ros","state","command","message","stationName","stations","onAddStation","bind","onClickStation","onSetGoal","actionClient","InsertStationService","DeleteStationService","GetStationService","componentDidMount","serverName","actionName","ActionClient","Service","name","serviceType","callService","res","setState","station_list","newStation","stationList","push","console","log","request","ServiceRequest","positionX","positionY","positionZ","orientationX","orientationY","orientationZ","orientationW","id","stationId","targetIndex","forEach","item","index","splice","positionVec3","Vector3","orientation","Quaternion","x","y","z","w","pose","Pose","position","goal","Goal","goalMessage","target_pose","header","frame_id","send","rootObject","render","fontSize","width","height","event","target","value","require","obj","station"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Container, Card, Button, Form, Row, Col, Alert } from \"react-bootstrap\";\nimport ROSLIB from \"roslib\";\nimport Nav2d from \"react-nav2djs\";\nimport \"./Map.css\";\nimport \"../CommonStyle.css\";\n\nclass Map extends Component {\n  constructor(props) {\n    super(props);\n    this.ros = props.ros || null;\n    this.state = {\n      command: 'none',\n      message: 'Robot is ready !',\n      stationName: 'NoName',\n      stations: [],\n    }\n    this.onAddStation = this.onAddStation.bind(this);\n    this.onClickStation = this.onClickStation.bind(this);\n    this.onSetGoal = this.onSetGoal.bind(this);\n    this.actionClient = null;\n    this.InsertStationService = null;\n    this.DeleteStationService = null;\n    this.GetStationService = null;\n  }\n\n  componentDidMount() {\n    if (this.props.ros != null) {\n      this.ros = this.props.ros;\n      var serverName = this.props.serverName || '/move_base';\n      var actionName = this.props.actionName || 'move_base_msgs/MoveBaseAction';\n      this.actionClient = new ROSLIB.ActionClient({\n        ros: this.ros,\n        actionName: actionName,\n        serverName: serverName\n      });\n      this.InsertStationService = new ROSLIB.Service({\n        ros: this.ros,\n        name: '/add_station',\n        serviceType: 'kobuki_ui/AddStation',\n      });\n      this.DeleteStationService = new ROSLIB.Service({\n        ros: this.ros,\n        name: '/delete_station',\n        serviceType: 'kobuki_ui/DeleteStation',\n      });\n      this.GetStationService = new ROSLIB.Service({\n        ros: this.ros,\n        name: '/get_station_list',\n        serviceType: 'kobuki_ui/GetStationList',\n      });\n      this.GetStationService.callService(null,(res) => {\n        this.setState({stations: res.station_list});\n      });\n    }\n  }\n\n  onAddStation(newStation) {\n    if (newStation) {\n      var stationList = this.state.stations;\n      stationList.push(newStation);\n      this.setState({stations: stationList});\n      console.log(\"added new station\", newStation.name);\n      var request = new ROSLIB.ServiceRequest({\n        name: newStation.name,\n        positionX: newStation.positionX,\n        positionY: newStation.positionY,\n        positionZ: newStation.positionZ,\n        orientationX: newStation.orientationX,\n        orientationY: newStation.orientationY,\n        orientationZ: newStation.orientationZ,\n        orientationW: newStation.orientationW,\n        id: newStation.id,\n      });\n      this.InsertStationService.callService(request);\n    }\n  }\n\n  onClickStation(stationId) {\n    var targetIndex = -1;\n    this.state.stations.forEach((item, index) => {\n      if (item.id === stationId) {\n        targetIndex = index;\n      }\n    });\n    if (targetIndex >= 0) {\n      if (this.state.command === 'DeleteStation') {\n        console.log(\"remove station\", this.state.stations[targetIndex].name);\n        var request = new ROSLIB.ServiceRequest({\n          id: this.state.stations[targetIndex].id,\n        });\n        this.DeleteStationService.callService(request);\n        var stationList = this.state.stations;\n        stationList.splice(targetIndex, 1);\n        this.setState({stations: stationList});\n      } else {\n        console.log(\"Go to station\", this.state.stations[targetIndex].name);\n        this.setState({message: 'Robot is moving to station ' + this.state.stations[targetIndex].name, command: 'CancelGoal'});\n        var positionVec3 = new ROSLIB.Vector3(null);\n        var orientation = new ROSLIB.Quaternion({\n          x: this.state.stations[targetIndex].orientationX,\n          y: this.state.stations[targetIndex].orientationY,\n          z: this.state.stations[targetIndex].orientationZ,\n          w: this.state.stations[targetIndex].orientationW\n        });\n        \n        positionVec3.x = this.state.stations[targetIndex].positionX;\n        positionVec3.y = this.state.stations[targetIndex].positionY;\n\n        var pose = new ROSLIB.Pose({\n          position : positionVec3,\n          orientation : orientation\n        });\n        console.log(pose);\n        var goal = new ROSLIB.Goal({\n          actionClient: this.actionClient,\n          goalMessage: {\n            target_pose: {\n              header: {\n                frame_id: 'map'\n              },\n              pose: pose,\n            }\n          }\n        });\n        goal.send();\n      }\n    }\n  }\n\n  onSetGoal(rootObject, pose) {\n    console.log(\"added new goal\");\n    this.setState({message: 'Robot is moving to Goal'});\n    var goal = new ROSLIB.Goal({\n      actionClient: this.actionClient,\n      goalMessage: {\n        target_pose: {\n          header: {\n            frame_id: 'map'\n          },\n          pose: pose\n        }\n      }\n    });\n    goal.send();\n  }\n\n  render() {\n    return (\n      <Container className=\"box-margin\">\n        <Card border=\"secondary\">\n          <Card.Header style={{fontSize: \"1.2rem\" }}><strong>Map</strong></Card.Header>\n          <Card.Body>\n            <Container className=\"map-container\" id=\"map\">\n              <Container className=\"map-controller\">\n                <Button className=\"map-button color\" onClick={() => this.setState({ command: 'SetGoal', message: 'Send goal to your robot' })}>Set Goal</Button>\n                <Button className=\"map-button\" variant='success' onClick={() => this.setState({ command: 'AddStation', message: 'Add new station', stationName: 'NoName' })}>Add Station</Button>\n                <Button className=\"map-button\" variant='outline-success' onClick={() => this.setState({ command: 'DeleteStation', message: 'Click to delete station' })}>Delete Station</Button>\n                <Button className=\"map-button\" variant='warning' onClick={() => this.setState({ command: 'none', message: 'Robot is ready !' })}>Cancel</Button>\n              </Container>\n              <Container style={{ width: \"28rem\", height: \"4rem\" }}>\n                {this.state.command === 'AddStation' &&\n                  <Form onChange={(event) => this.setState({stationName: event.target.value})}>\n                    <Form.Group as={Row} controlId=\"formHorizontalEmail\">\n                      <Form.Label column sm={3}>\n                        Station:\n                      </Form.Label>\n                      <Col sm={8}>\n                        <Form.Control type=\"text\" placeholder=\"ex: Table\" />\n                      </Col>\n                    </Form.Group>\n                  </Form>\n                }\n                {this.state.command !== 'AddStation' &&\n                  <Alert variant=\"info\">{this.state.message}</Alert>\n                }\n              </Container>\n              <Nav2d\n                id='random'\n                imageRobot={require('./jarvis.png')}\n                imageGoalArrow={require('./arrow-red.png')}\n                imageStationArrow={require('./arrow-green.png')}\n                ros={this.ros}\n                serverName='/move_base'\n                command={this.state.command}\n                onSetGoal={(obj, pose) => this.onSetGoal(obj, pose)}\n                onAddStation={(newStation) => this.onAddStation(newStation)}\n                onClickStation={(station) => this.onClickStation(station)}\n                stationName={this.state.stationName}\n                station={this.state.stations}\n              />\n            </Container>\n          </Card.Body>\n        </Card>\n      </Container>\n    )\n  }\n}\n\nexport default Map;"]},"metadata":{},"sourceType":"module"}