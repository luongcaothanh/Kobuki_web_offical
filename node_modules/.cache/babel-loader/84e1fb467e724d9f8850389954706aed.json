{"ast":null,"code":"var _jsxFileName = \"/home/luong/kobuki_web/src/components/Controller/Controller.js\";\nimport React, { Component } from \"react\";\nimport { Container, Card, Col, Row, Button, ButtonGroup, ToggleButton } from \"react-bootstrap\";\nimport \"../CommonStyle.css\";\nimport \"./Controller.css\";\nimport { Direction } from \"../Common/Common.ts\";\nimport ROSLIB from \"roslib\";\nconst Command = [{\n  dir: Direction.NorthWest,\n  code: 85\n}, {\n  dir: Direction.North,\n  code: 73\n}, {\n  dir: Direction.NorthEast,\n  code: 79\n}, {\n  dir: Direction.West,\n  code: 74\n}, {\n  dir: Direction.Center,\n  code: 75\n}, {\n  dir: Direction.East,\n  code: 76\n}, {\n  dir: Direction.SouthWest,\n  code: 77\n}, {\n  dir: Direction.South,\n  code: 188\n}, {\n  dir: Direction.SouthEast,\n  code: 190\n}];\n\nfunction ControlButton(props) {\n  return /*#__PURE__*/React.createElement(Button, {\n    variant: \"secondary\",\n    size: \"lg\",\n    className: \"button-control\",\n    onClick: props.onClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 10\n    }\n  }, props.label);\n}\n\nconst arrVel = [[[1, 0, 0, 0, 0, 1], [1, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, -1], [0, 0, 0, 0, 0, 1], [0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, -1], [-1, 0, 0, 0, 0, -1], [-1, 0, 0, 0, 0, 0], [-1, 0, 0, 0, 0, 1]], [[1, -1, 0, 0, 0, 0], [1, 0, 0, 0, 0, 0], [1, 1, 0, 0, 0, 0], [0, -1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0], [-1, -1, 0, 0, 0, 0], [-1, 0, 0, 0, 0, 0], [-1, 1, 0, 0, 0, 0]]];\n\nclass Controller extends Component {\n  constructor(props) {\n    super(props);\n\n    this._handleKeyDown = event => {\n      // console.log(\"pressed \" + event.keyCode);\n      let target = Command.find(item => {\n        if (item.code == event.keyCode) {\n          return item;\n        }\n      });\n\n      if (target) {\n        // console.log(\"press dir \" + target.dir);\n        this.onControl(0, target.dir);\n      }\n    };\n\n    this.state = {\n      keyboard_enable: false,\n      radioValue: '1',\n      checked: false\n    };\n    this.angularVel = props.angularVel || 0;\n    this.linearVel = props.linearVel || 0;\n    this.ros = props.ros || null;\n    this.addEventKeyboard = false;\n    this.onChangeKeyboardControl = this.onChangeKeyboardControl.bind(this);\n    this.onClickControlButton = this.onClickControlButton.bind(this);\n    this._handleKeyDown = this._handleKeyDown.bind(this);\n    this.onControl = this.onControl.bind(this);\n    this.cur_dir = 4; // stop\n\n    this.cmdVel = null;\n    this.mappingModeService = null;\n    this.localizationModeService = null;\n  }\n\n  onChangeKeyboardControl(event) {\n    console.log(\"change switch \" + event.target.checked);\n    this.setState({\n      keyboard_enable: event.target.checked\n    });\n\n    if (event.target.checked == true) {\n      if (!this.addEventKeyboard) {\n        console.log(\"Enable keyboard\");\n        document.addEventListener(\"keydown\", this._handleKeyDown);\n        this.addEventKeyboard = true;\n      }\n    } else if (event.target.checked == false) {\n      if (this.addEventKeyboard) {\n        console.log(\"Disable keyboard\");\n        document.removeEventListener(\"keydown\", this._handleKeyDown);\n        this.addEventKeyboard = false;\n      }\n    }\n  }\n\n  onControl(mode, dir) {\n    this.cur_dir = dir;\n\n    if (!this.cmdVel || this.ros == null) {\n      return;\n    }\n\n    console.log(\"mode \" + mode + \" direction \" + dir + \" with velocity \" + this.linearVel + \", \" + this.angularVel);\n\n    if (mode > 1 || mode < 0 || dir < 0 || dir > 9) {\n      console.log(\"Invalid control\");\n    }\n\n    var newVelMsg = new ROSLIB.Message({\n      linear: {\n        x: arrVel[mode][dir][0] * this.linearVel,\n        y: arrVel[mode][dir][1] * this.linearVel,\n        z: arrVel[mode][dir][2] * this.linearVel\n      },\n      angular: {\n        x: arrVel[mode][dir][3] * this.angularVel,\n        y: arrVel[mode][dir][4] * this.angularVel,\n        z: arrVel[mode][dir][5] * this.angularVel\n      }\n    });\n    this.cmdVel.publish(newVelMsg);\n  }\n\n  onClickControlButton(direction) {\n    console.log(\"click \" + direction);\n    this.onControl(0, direction);\n  }\n\n  componentWillUnmount() {\n    if (this.addEventKeyboard) {\n      document.removeEventListener(\"keydown\", this._handleKeyDown);\n    }\n  }\n\n  componentDidUpdate() {\n    this.angularVel = this.props.angularVel || 0;\n    this.linearVel = this.props.linearVel || 0;\n\n    if (this.ros != this.props.ros) {\n      this.ros = this.props.ros;\n\n      if (this.ros != null) {\n        this.cmdVel = new ROSLIB.Topic({\n          ros: this.ros,\n          name: '/cmd_vel_mux/keyboard_teleop',\n          messageType: 'geometry_msgs/Twist'\n        });\n        var newVelMsg = new ROSLIB.Message({\n          linear: {\n            x: 0,\n            y: 0,\n            z: 0\n          },\n          angular: {\n            x: 0,\n            y: 0,\n            z: 0\n          }\n        });\n        this.cur_dir = 4;\n        this.cmdVel.publish(newVelMsg);\n      }\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(Container, {\n      className: \"box-margin\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 7\n      }\n    }, console.log(this.props), /*#__PURE__*/React.createElement(Card, {\n      border: \"secondary\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Card.Header, {\n      style: {\n        fontSize: \"1.2rem\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 54\n      }\n    }, \"Controller\")), /*#__PURE__*/React.createElement(Card.Body, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 15\n      }\n    }, \"Keyboard Control\"), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      class: \"switch\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      onChange: this.onChangeKeyboardControl,\n      checked: this.state.keyboard_enable,\n      type: \"checkbox\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 195,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"span\", {\n      class: \"slider round\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 19\n      }\n    })))), /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"u\",\n      onClick: () => this.onClickControlButton(Direction.NorthWest),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 20\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"i\",\n      onClick: () => this.onClickControlButton(Direction.North),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 20\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"o\",\n      onClick: () => this.onClickControlButton(Direction.NorthEast),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 20\n      }\n    }))), /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"j\",\n      onClick: () => this.onClickControlButton(Direction.West),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 20\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"k\",\n      onClick: () => this.onClickControlButton(Direction.Center),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 20\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"l\",\n      onClick: () => this.onClickControlButton(Direction.East),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 20\n      }\n    }))), /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \"m\",\n      onClick: () => this.onClickControlButton(Direction.SouthWest),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211,\n        columnNumber: 20\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \",\",\n      onClick: () => this.onClickControlButton(Direction.South),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 20\n      }\n    })), /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(ControlButton, {\n      label: \".\",\n      onClick: () => this.onClickControlButton(Direction.SouthEast),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 20\n      }\n    }))), /*#__PURE__*/React.createElement(Row, {\n      style: {\n        borderBottom: \"1px dotted gray\",\n        paddingBottom: \"1rem\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      variant: \"secondary\",\n      size: \"lg\",\n      style: {\n        width: \"100%\",\n        height: \"6ex\",\n        margin: \"0.75ex\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 20\n      }\n    }, \"Shift\"))))));\n  }\n\n}\n\nexport default Controller;","map":{"version":3,"sources":["/home/luong/kobuki_web/src/components/Controller/Controller.js"],"names":["React","Component","Container","Card","Col","Row","Button","ButtonGroup","ToggleButton","Direction","ROSLIB","Command","dir","NorthWest","code","North","NorthEast","West","Center","East","SouthWest","South","SouthEast","ControlButton","props","onClick","label","arrVel","Controller","constructor","_handleKeyDown","event","target","find","item","keyCode","onControl","state","keyboard_enable","radioValue","checked","angularVel","linearVel","ros","addEventKeyboard","onChangeKeyboardControl","bind","onClickControlButton","cur_dir","cmdVel","mappingModeService","localizationModeService","console","log","setState","document","addEventListener","removeEventListener","mode","newVelMsg","Message","linear","x","y","z","angular","publish","direction","componentWillUnmount","componentDidUpdate","Topic","name","messageType","render","fontSize","borderBottom","paddingBottom","width","height","margin"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport { Container, Card, Col, Row, Button, ButtonGroup, ToggleButton } from \"react-bootstrap\";\nimport \"../CommonStyle.css\";\nimport \"./Controller.css\";\nimport { Direction } from \"../Common/Common.ts\";\nimport ROSLIB from \"roslib\";\n\nconst Command = [\n  {\n    dir: Direction.NorthWest, code: 85\n  },\n  {\n    dir: Direction.North, code: 73\n  },\n  {\n    dir: Direction.NorthEast, code: 79\n  },\n  {\n    dir: Direction.West, code: 74\n  },\n  {\n    dir: Direction.Center, code: 75\n  },\n  {\n    dir: Direction.East, code: 76\n  },\n  {\n    dir: Direction.SouthWest, code: 77\n  },\n  {\n    dir: Direction.South, code: 188\n  },\n  {\n    dir: Direction.SouthEast, code: 190\n  },\n];\n\nfunction ControlButton(props) {\n  return <Button variant=\"secondary\" size=\"lg\" className=\"button-control\" onClick={props.onClick}>{props.label}</Button>\n}\n\nconst arrVel = [\n  [\n    [1, 0, 0, 0, 0, 1],\n    [1, 0, 0, 0, 0, 0],\n    [1, 0, 0, 0, 0, -1],\n    [0, 0, 0, 0, 0, 1],\n    [0, 0, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, -1],\n    [-1, 0, 0, 0, 0, -1],\n    [-1, 0, 0, 0, 0, 0],\n    [-1, 0, 0, 0, 0, 1],\n  ],\n  [\n    [1, -1, 0, 0, 0, 0],\n    [1, 0, 0, 0, 0, 0],\n    [1, 1, 0, 0, 0, 0],\n    [0, -1, 0, 0, 0, 0],\n    [0, 0, 0, 0, 0, 0],\n    [0, 1, 0, 0, 0, 0],\n    [-1, -1, 0, 0, 0, 0],\n    [-1, 0, 0, 0, 0, 0],\n    [-1, 1, 0, 0, 0, 0],\n  ]\n];\n\nclass Controller extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      keyboard_enable: false,\n      radioValue: '1',\n      checked: false,\n    };\n    this.angularVel = props.angularVel || 0;\n    this.linearVel = props.linearVel || 0;\n    this.ros = props.ros || null;\n    this.addEventKeyboard = false;\n    this.onChangeKeyboardControl = this.onChangeKeyboardControl.bind(this);\n    this.onClickControlButton = this.onClickControlButton.bind(this);\n    this._handleKeyDown = this._handleKeyDown.bind(this);\n    this.onControl = this.onControl.bind(this);\n    this.cur_dir = 4; // stop\n    this.cmdVel = null;\n    this.mappingModeService = null;\n    this.localizationModeService = null;\n  }\n\n  _handleKeyDown = (event) => {\n    // console.log(\"pressed \" + event.keyCode);\n    let target = Command.find(item => {\n      if (item.code == event.keyCode) {\n        return item;\n      }\n    });\n    if (target) {\n      // console.log(\"press dir \" + target.dir);\n      this.onControl(0, target.dir);\n    }\n  }\n\n  onChangeKeyboardControl(event) {\n    console.log(\"change switch \" + event.target.checked);\n    this.setState({ keyboard_enable: event.target.checked });\n    if (event.target.checked == true) {\n      if (!this.addEventKeyboard) {\n        console.log(\"Enable keyboard\");\n        document.addEventListener(\"keydown\", this._handleKeyDown);\n        this.addEventKeyboard = true;\n      }\n    } else if (event.target.checked == false) {\n      if (this.addEventKeyboard) {\n        console.log(\"Disable keyboard\");\n        document.removeEventListener(\"keydown\", this._handleKeyDown);\n        this.addEventKeyboard = false;\n      }\n    }\n  }\n\n  onControl(mode, dir) {\n    this.cur_dir = dir;\n    if (!this.cmdVel || this.ros == null) {\n      return;\n    }\n    console.log(\"mode \" + mode + \" direction \" + dir + \" with velocity \" + this.linearVel + \", \" + this.angularVel);\n    if (mode > 1 || mode < 0 || dir < 0 || dir > 9) {\n      console.log(\"Invalid control\");\n    }\n    var newVelMsg = new ROSLIB.Message({\n      linear : {\n        x : arrVel[mode][dir][0] * this.linearVel,\n        y : arrVel[mode][dir][1] * this.linearVel,\n        z : arrVel[mode][dir][2] * this.linearVel,\n      },\n      angular : {\n        x : arrVel[mode][dir][3] * this.angularVel,\n        y : arrVel[mode][dir][4] * this.angularVel,\n        z : arrVel[mode][dir][5] * this.angularVel,\n      }\n    });\n    this.cmdVel.publish(newVelMsg);\n  }\n\n  onClickControlButton(direction) {\n    console.log(\"click \" + direction);\n    this.onControl(0, direction);\n  }\n\n  componentWillUnmount() {\n    if (this.addEventKeyboard) {\n      document.removeEventListener(\"keydown\", this._handleKeyDown);\n    }\n  }\n\n  componentDidUpdate() {\n    this.angularVel = this.props.angularVel || 0;\n    this.linearVel = this.props.linearVel || 0;\n    if (this.ros != this.props.ros) {\n      this.ros = this.props.ros;\n      if (this.ros != null) {\n        this.cmdVel = new ROSLIB.Topic({\n          ros : this.ros,\n          name : '/cmd_vel_mux/keyboard_teleop',\n          messageType : 'geometry_msgs/Twist'\n        });\n        var newVelMsg = new ROSLIB.Message({\n          linear : {\n            x : 0,\n            y : 0,\n            z : 0,\n          },\n          angular : {\n            x : 0,\n            y : 0,\n            z : 0,\n          }\n        });\n        this.cur_dir = 4;\n        this.cmdVel.publish(newVelMsg);\n      }\n    }\n  }\n\n  render() {\n    return (\n      <Container className=\"box-margin\">\n        {console.log(this.props)}\n        <Card border=\"secondary\">\n          <Card.Header style={{fontSize: \"1.2rem\" }}><strong>Controller</strong></Card.Header>\n          <Card.Body>\n            <Row>\n              <Col>Keyboard Control</Col>\n              <Col>\n                <label class=\"switch\">\n                  <input onChange={this.onChangeKeyboardControl} checked={this.state.keyboard_enable} type=\"checkbox\" />\n                  <span class=\"slider round\"></span>\n                </label>\n              </Col>\n            </Row>\n            <Row>\n              <Col><ControlButton label=\"u\" onClick={() => this.onClickControlButton(Direction.NorthWest)} /></Col>\n              <Col><ControlButton label=\"i\" onClick={() => this.onClickControlButton(Direction.North)} /></Col>\n              <Col><ControlButton label=\"o\" onClick={() => this.onClickControlButton(Direction.NorthEast)} /></Col>\n            </Row>\n            <Row>\n              <Col><ControlButton label=\"j\" onClick={() => this.onClickControlButton(Direction.West)} /></Col>\n              <Col><ControlButton label=\"k\" onClick={() => this.onClickControlButton(Direction.Center)} /></Col>\n              <Col><ControlButton label=\"l\" onClick={() => this.onClickControlButton(Direction.East)} /></Col>\n            </Row>\n            <Row>\n              <Col><ControlButton label=\"m\" onClick={() => this.onClickControlButton(Direction.SouthWest)} /></Col>\n              <Col><ControlButton label=\",\" onClick={() => this.onClickControlButton(Direction.South)} /></Col>\n              <Col><ControlButton label=\".\" onClick={() => this.onClickControlButton(Direction.SouthEast)} /></Col>\n            </Row>\n            <Row style={{borderBottom: \"1px dotted gray\", paddingBottom: \"1rem\"}}>\n              <Col><Button variant=\"secondary\" size=\"lg\" style={{ width: \"100%\", height: \"6ex\", margin: \"0.75ex\" }}>Shift</Button></Col>\n            </Row>\n          </Card.Body>\n        </Card>\n      </Container>\n    )\n  }\n}\n\nexport default Controller;"]},"metadata":{},"sourceType":"module"}